# TOD社区小程序功能需求文档

## 概述

本文档详细描述了TOD社区小程序的功能需求和实现路线图。该项目遵循"纯免费、靠捐赠维持"的公益原则，旨在为社区住户、商家和物业管理提供一个信息透明、服务高效、邻里互助的数字化平台。

## 核心价值主张

- **信息透明**：社区信息公开透明，增强住户参与度
- **服务高效**：简化日常生活服务流程，提升便民体验  
- **邻里互助**：促进社区成员之间的交流与协作
- **数字化管理**：提升物业管理效率和服务质量

## 功能路线图

### 第一阶段：MVP 核心功能 (优先级：P0)
*实施周期：1-2个月*

#### 1. 住户认证系统
**功能描述**：建立社区信任基石的实名认证体系

**用户价值**：
- 确保社区信息安全，防止外部人员恶意使用
- 建立可信的社区交流环境
- 为后续功能使用提供身份基础

**功能细节**：
- 住户提供楼栋门牌号信息
- 物业或志愿者管理员审核机制
- 认证状态标识和权限控制
- 支持多种认证方式（房产证、租赁合同等）

**技术要求**：
- 微信授权登录集成
- 审核工作流系统
- 用户权限管理

#### 2. 社区公告发布
**功能描述**：官方信息发布和通知推送平台

**用户价值**：
- 及时获取重要社区信息和通知
- 减少信息传达的层级和延误
- 提高社区事务透明度

**功能细节**：
- 物业/管理员发布权限控制
- 公告分类管理（紧急通知、日常公告、活动信息等）
- 消息推送和提醒功能
- 公告浏览历史和搜索

**技术要求**：
- 内容管理系统
- 消息推送服务
- 富文本编辑器

#### 3. 商家黄页服务
**功能描述**：社区周边商家信息展示平台

**用户价值**：
- 便于发现社区周边优质商家
- 支持本地经济发展
- 获取商家联系方式和服务信息

**功能细节**：
- 商家基本信息展示（名称、地址、联系方式）
- 商家分类检索（餐饮、超市、维修、教育等）
- 商家评价和推荐系统
- 地图定位集成

**技术要求**：
- 商家信息数据库
- 分类和搜索功能
- 地图API集成

#### 4. 邻里互助平台
**功能描述**：社区成员互助交流的BBS论坛

**用户价值**：
- 促进邻里关系，增强社区凝聚力
- 便于求助和提供帮助
- 分享生活经验和资源

**功能细节**：
- 失物招领板块
- 互助求助发布
- 经验分享交流
- 二手物品交换
- 拼车拼团组织

**技术要求**：
- 论坛系统架构
- 内容审核机制
- 图片上传功能

#### 5. 捐赠与财务公示
**功能描述**：透明的资金管理和公示系统

**用户价值**：
- 保证项目运营透明度
- 支持公益项目可持续发展
- 建立社区信任基础

**功能细节**：
- 捐赠入口和支付集成
- 实时财务收支公示
- 捐赠记录查询（保护隐私）
- 资金使用明细展示

**技术要求**：
- 支付系统集成
- 财务数据管理
- 报表生成功能

### 第二阶段：功能拓展 (优先级：P1)
*实施周期：3-6个月*

#### 6. 在线报修服务
**功能描述**：便民报修工单管理系统

**用户价值**：
- 简化报修流程，提高处理效率
- 实时跟踪报修进度
- 减少电话沟通成本

**功能细节**：
- 在线提交报修申请（文字+图片）
- 报修类型分类（水电、门窗、公共设施等）
- 工单状态跟踪和更新通知
- 服务评价反馈系统

**技术要求**：
- 工单管理系统
- 图片上传和处理
- 状态流转管理
- 推送通知服务

#### 7. 公共设施预约
**功能描述**：社区公共资源预约管理系统

**用户价值**：
- 合理分配公共资源使用权
- 避免设施使用冲突
- 提高设施利用率

**功能细节**：
- 设施预约日历展示
- 预约时间段管理
- 预约冲突检测和提醒
- 取消和改期功能

**技术要求**：
- 预约管理系统
- 日历组件集成
- 冲突检测算法
- 通知提醒功能

#### 8. 投票问卷系统
**功能描述**：社区公共事务决策参与平台

**用户价值**：
- 参与社区公共事务决策
- 表达个人意见和建议
- 提高社区民主参与度

**功能细节**：
- 投票活动创建和管理
- 多种投票类型支持（单选、多选、排序）
- 问卷调查功能
- 结果统计和展示

**技术要求**：
- 投票引擎开发
- 统计分析功能
- 匿名投票保护
- 结果可视化

#### 9. 智能订阅通知
**功能描述**：个性化消息推送服务

**用户价值**：
- 及时获取关心的信息
- 减少信息噪音干扰
- 个性化服务体验

**功能细节**：
- 订阅偏好设置
- 关键事件智能提醒
- 推送时间优化
- 消息分类管理

**技术要求**：
- 订阅管理系统
- 智能推送算法
- 微信订阅消息API
- 用户偏好分析

### 自定义消息推送网关

- **功能定位**
  - 解决微信服务通知模板审核困难、下发不灵活的问题。提供一个类似 Server酱 / PushDeer 的统一消息推送服务，作为系统通知的补充和兜底方案。
- **核心能力**
  - **多通道支持**：初期支持企业微信应用、钉钉机器人，后续可扩展飞书、自定义 Webhook 等。
  - **统一 API**：提供简单的 RESTful API (`POST /api/push`)，业务方只需调用一个接口即可发送通知，无需关心底层通道实现。
  - **用户绑定**：用户可在个人中心绑定自己的推送接收方式（如提供企业微信 `uid`、钉钉 Webhook 地址等）。未绑定的用户则无法接收此类通知。
  - **消息模板**：支持简单的 Markdown 格式，可定义标题和正文内容。
- **典型推送场景**
  - **面向用户**：接龙下单成功、活动即将截止提醒、异步导出任务完成等。
  - **面向管理员**：系统异常报警、用户反馈提交、高风险操作日志等。
- **管理功能**
  - **通道管理**：管理员可配置全局的推送通道（如官方的企业微信应用）。
  - **日志与监控**：记录每条消息的推送请求、目标通道、状态和耗时，方便排查问题。
  - **安全与限流**：对 API 调用进行身份验证和频率限制，防止滥用。
- **数据模型 (CloudBase 建议)**
  - `user_push_bindings`:
    - `user_id`, `channel_type` (enum: `wecom`, `dingtalk`, `webhook`), `channel_config` (JSON, 加密存储), `is_active` (bool), `remark`
  - `push_logs`:
    - `log_id`, `trace_id`, `user_id` (nullable), `channel_type`, `title`, `status` (enum: `success`, `failed`), `error_message`, `created_at`
- **里程碑拆分**
  - **M1 (1 周)**：实现核心推送 API，优先支持企业微信应用通道；完成管理后台的全局通道配置。
  - **M2 (1 周)**：开放用户个人中心绑定推送通道的功能；完成"接龙下单成功"场景的对接。
  - **M3 (后续)**：增加钉钉机器人等更多通道；完善推送日志查询与监控面板。

### 接龙团购工具

- **功能定位**
  - 面向小区内部的商家/个人商家发起"接龙"活动，居民参与填写商品与数量，平台仅做信息收集、统计与导出，不涉及任何线上支付。
- **角色与权限**
  - **发起者（商家/个人商家）**：需完成商家或个人商家认证（至少手机号+基本资料），可创建/管理自身接龙。
  - **参与者（居民）**：必须完成业主认证或租客认证后方可参与接龙。
  - **管理员/志愿者**：可审核与下架违规接龙，查看并导出全量汇总数据。
- **活动与商品配置**
  - **接龙活动**：标题、分类（品类标签）、说明、封面图、关联商户、适用范围（全小区/指定楼栋）、开始/截止时间（显示倒计时）、可见性（仅认证用户可见）、是否允许截止前修改/撤回。
  - **商品项**：名称、规格/口味、单位、单价（可为空以隐藏价格）、是否显示价格、最小起订量、每人限购、库存上限（可选）、是否需要备注、排序。
- **参与与提交**
  - 参与者需补充：楼栋、房号、联系人姓名、手机号（至少手机号与"楼栋+房号"为必填）。
  - 选择商品与数量，支持逐项备注；在截止前可修改/撤回（若活动开启此选项）。
  - **防重复**：同一用户对同一活动仅保留最新一次提交（或叠加，按活动设置）。
- **活动状态与展示**
  - **状态**：未开始 / 进行中 / 已截止 / 已结单。
  - **列表**：按状态分组显示，支持关键字、分类、楼栋范围筛选。
  - **详情页**：活动说明、剩余时间、商品清单、我的提交、楼栋可见范围提示。
- **统计与结果页**
  - **实时统计**：按商品汇总（总份数、总金额[若有单价]）、按楼栋汇总、参与人数、提交次数。
  - **截止后结果页**：展示最终统计与明细，可分享给认证用户查看。
  - **导出**：CSV/Excel 导出明细与汇总；支持按楼栋分页导出。
- **商家/个人商家管理**
  - **活动管理**：创建、编辑、复制活动；手动结单；下架。
  - **订单管理（接龙明细）**：按楼栋/房号分组查看，支持筛选（未取货、已取货等自定义标记）。
  - **标签打印**：生成标签模板，按楼栋排序批量导出打印。
- **标签模板（示例字段）**
  - 楼栋-房号、联系人姓名、手机号尾号、活动标题、取货时间（可选）、商品明细（名称×数量、规格、备注）、商家联系方式或取货点。
- **通知与订阅（可选）**
  - **订阅消息**：我的提交被商家标记、活动即将截止提醒、活动结单提醒（面向参与者与发起者）。
- **合规与约束**
  - 明确申明本功能仅用于信息收集与统计，不涉及任何线上支付或资金托管；支付与交付由线下自理。
  - 内容与图片需通过内容安全校验；违规活动可被管理员下架。
  - **数据最小化**：仅收集完成履约所需信息（楼栋、房号、联系信息等）。
- **边界与异常处理**
  - **库存/限购**：下单时校验库存与人均限购；库存可选"无限制"。
  - **修改/撤回**：仅在截止前允许，结单后只读。
  - **超售处理**：商家后台可部分调整明细并备注原因（例如缺货），变更会记录到操作日志。
- **非功能性要求**
  - **性能**：列表/统计在典型小区规模（百-千人参与）下秒级响应；统计采用增量聚合减少全量扫描。
  - **可靠性**：关键写操作幂等（防二次提交）；并发写入采用事务/乐观锁。
  - **可观测性**：活动、订单、导出操作留审计日志；关键指标埋点。
- **数据模型（CloudBase 文档型建议）**
  - **collections**:
    - `group_activities`
      - `id`, `title`, `category`, `cover`, `merchant_id`, `scope_buildings[]`, `start_time`, `end_time`, `allow_edit_before_deadline(bool)`, `visible_to("authenticated")`, `status(enum: pending|running|ended|closed)`, `created_by`, `created_at`, `updated_at`
    - `group_items`
      - `id`, `activity_id`, `name`, `spec`, `unit`, `price(nullable)`, `show_price(bool)`, `min_qty`, `per_user_limit(nullable)`, `stock_limit(nullable)`, `need_remark(bool)`, `sort`
    - `group_orders`
      - `id`, `activity_id`, `user_id`, `building`, `room_no`, `contact_name`, `phone`, `items:[{item_id, qty, remark}]`, `amount(optional, computed)`, `status(enum: submitted|adjusted|picked)`, `version`, `created_at`, `updated_at`
    - `merchants`
      - 扩展字段：`type(personal|business)`, `contact_phone`, `pickup_location`, `verified(bool)`
    - `group_activity_stats` (可选预聚合)
      - `activity_id`, `totals_by_item[{item_id, total_qty, total_amount}]`, `totals_by_building[{building, total_qty, total_amount}]`, `participants`
  - **索引建议**：`group_orders` 上 `activity_id`、`building`、`user_id` 复合索引；`group_items` 上 `activity_id`+`sort`；`group_activities` 上 `status`+`end_time`。
- **核心流程**
  - 发起者创建活动与商品 → 审核（可选）→ 上线 → 居民参与并提交 → 截止自动结算统计 → 发起者查看/导出/打印 → 线下履约与取货标记 → 归档。
- **里程碑拆分**
  - **M1（1 周）**：活动创建/列表/详情、居民参与提交、基本统计、仅认证可见。
  - **M2（1-2 周）**：库存/限购、修改/撤回、导出 CSV、按楼栋查看。
  - **M3（1 周）**：标签模板与批量打印、订阅消息、操作日志。
  - **M4（后续）**：预聚合统计、复制活动、多小区适配。

### 第三阶段：生态建设 (优先级：P2)
*实施周期：6个月以后*

#### 10. 志愿者管理体系
**功能描述**：社区志愿者招募和管理平台

**用户价值**：
- 参与社区建设，提升归属感
- 发挥个人专长，服务社区
- 建立良好的邻里关系

**功能细节**：
- 志愿者招募和报名
- 志愿服务项目发布
- 服务时长统计和激励
- 志愿者培训和认证

**技术要求**：
- 用户角色管理
- 服务记录系统
- 积分奖励机制
- 培训内容管理

#### 11. 社区活动组织
**功能描述**：线上发起、线下组织的活动管理平台

**用户价值**：
- 丰富社区文化生活
- 增进邻里交流和友谊
- 提升社区活力和凝聚力

**功能细节**：
- 活动创建和发布
- 活动报名和管理
- 活动图片和视频分享
- 活动效果评估和反馈

**技术要求**：
- 活动管理系统
- 报名统计功能
- 多媒体内容管理
- 社交分享功能

#### 12. 财务自动化管理
**功能描述**：自动化财务记录和报告系统

**用户价值**：
- 提高财务管理透明度
- 减少人工操作错误
- 实时财务状况监控

**功能细节**：
- 自动捐赠记录入账
- 支出审批工作流
- 财务报表自动生成
- 预算管理和预警

**技术要求**：
- 云函数自动化
- 财务数据接口
- 报表生成引擎
- 审批流程引擎

#### 13. 开源协作平台
**功能描述**：技术爱好者参与贡献的开源项目

**用户价值**：
- 推动技术创新和改进
- 建立技术社区生态
- 提升项目可持续性

**功能细节**：
- GitHub项目开源
- 贡献者管理和激励
- 技术文档维护
- 社区反馈和建议收集

**技术要求**：
- 版本控制系统
- CI/CD自动化部署
- 代码审查流程
- 社区协作工具

## 技术架构要求

### 前端技术栈
- **微信原生小程序**：利用微信生态优势，降低用户使用门槛
- **响应式设计**：适配不同屏幕尺寸和设备
- **用户体验优化**：遵循微信设计规范，提供流畅体验

### 后端技术栈
- **微信云开发 (Tencent CloudBase)**：初期低成本解决方案
- **云函数**：无服务器架构，按需付费
- **云数据库**：文档型数据库，灵活扩展

### 数据模型设计

#### 核心数据表
```
users (用户表)
├── openid: 微信用户唯一标识
├── auth_status: 认证状态
├── building_info: 楼栋单元信息
├── role: 用户角色 (住户/管理员/志愿者)
└── created_at: 创建时间

posts (信息发布表)
├── type: 发布类型 (公告/互助/活动等)
├── content: 内容文本
├── images: 图片附件
├── author: 发布者ID
├── status: 审核状态
└── created_at: 发布时间

merchants (商家表)
├── name: 商家名称
├── category: 行业分类
├── contact: 联系方式
├── address: 详细地址
├── description: 商家描述
└── verified: 认证状态

donations (捐赠表)
├── amount: 捐赠金额
├── donor_nickname: 捐赠者昵称 (可选)
├── created_at: 捐赠时间
└── status: 到账状态

ledgers (收支账本表)
├── type: 类型 (收入/支出)
├── amount: 金额
├── description: 事由说明
├── category: 支出分类
└── created_at: 记录时间
```

## 合规与安全要求

### 数据安全
- 严格遵守《个人信息保护法》等相关法规
- 实施数据最小化收集原则
- 用户数据加密存储和传输
- 定期安全审计和漏洞修复

### 内容安全
- 接入微信内容安全接口
- 建立内容审核机制
- 违规内容自动过滤和人工复审
- 用户举报和处理流程

### 隐私保护
- 明确的隐私政策和用户协议
- 用户数据控制权保障
- 匿名化数据处理
- 数据删除和导出功能

## 运营与推广策略

### 用户获取
- 物业公告板宣传推广
- 业主群分享和推荐
- 线下活动现场推广
- 口碑传播和用户推荐

### 用户留存
- 高质量内容和服务
- 及时响应用户反馈
- 定期功能更新和优化
- 社区活动和互动

### 社区治理
- 建立社区公约和规则
- 培养活跃用户和意见领袖
- 定期社区满意度调研
- 持续改进和创新

## 成本预算

### 开发成本
- **人力投入**：技术开发和产品设计
- **时间周期**：按阶段实施，逐步完善

### 运营成本
- **服务器费用**：初期微信云开发几乎零成本，后期预计每月50-100元
- **小程序认证**：每年300元认证费用
- **域名费用**：年度续费约100元
- **其他成本**：推广宣传、活动组织等

### 资金来源
- **社区捐赠**：住户自愿捐赠支持
- **透明使用**：所有资金使用公开透明
- **成本控制**：坚持低成本运营原则

## 成功指标

### 用户指标
- **注册用户数**：目标覆盖社区80%以上住户
- **活跃用户数**：月活跃用户占注册用户50%以上
- **用户留存率**：月用户留存率达到70%以上

### 功能使用指标
- **公告阅读率**：重要公告阅读率达90%以上
- **报修响应时间**：平均响应时间少于2小时
- **社区参与度**：投票参与率达到60%以上

### 社区建设指标
- **邻里互助活跃度**：每月互助帖数量和回应率
- **社区活动参与**：线下活动参与人数和频次
- **用户满意度**：季度用户满意度调研评分

---

*本文档将根据项目进展和用户反馈持续更新和完善。*